<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width" />
    <title>@ViewBag.Title</title>
    <meta name="cwps-meta-v-id" content="@version" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
        crossorigin="anonymous" referrerpolicy="no-referrer">
    <style>
        .nav-link {
            color: white;
        }

        .nav-link:hover {
            color: yellow;
        }

        .text-danger {
            color: yellow !important;
        }

        a:hover {
            color: yellow;
        }

        a {
            color: wheat;
        }

        .setup-wizard {
            max-width: 800px;
            margin: 50px auto;
            padding: 30px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .setup-step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }

        .setup-step {
            flex: 1;
            text-align: center;
            padding: 10px;
            border-bottom: 3px solid #dee2e6;
            color: #6c757d;
        }

        .setup-step.active {
            border-bottom-color: #007bff;
            color: #007bff;
            font-weight: bold;
        }

        .setup-step.completed {
            border-bottom-color: #28a745;
            color: #28a745;
        }

        .test-result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
        }

        .test-success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .test-error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        /* Highlight validation errors */
        .input-validation-error {
            border-color: #dc3545 !important;
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
        }

        .field-validation-error {
            display: block;
            margin-top: 0.25rem;
            font-size: 0.875em;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    @await RenderSectionAsync("Styles", false)
</head>

<body class="cwps-body bg-dark text-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <!-- Toggle button -->
        <button class="navbar-toggler" type="button" data-mdb-toggle="collapse" data-mdb-target="#navbarCenteredExample"
            aria-controls="navbarCenteredExample" aria-expanded="false" aria-label="Toggle navigation">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Collapsible wrapper -->
        <div class="collapse navbar-collapse justify-content-center" id="navbarCenteredExample">
            <!-- Left links -->
            <ul class="navbar-nav mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/">
                        <img src="/images/skycms/SkyCMSLogoNoWiTextDarkTransparent30h.png" height="30" />
                    </a>
                </li>
            </ul>
            <!-- Left links -->
        </div>
        <!-- Collapsible wrapper -->
    </nav>
    <div id="main-content" class="main-content">
        <div class="container m-y-lg">
            <main class="main-primary">
                                   <div class="row justify-content-center">
                        <div class="col-md-6">
                            @await Html.PartialAsync("_SetupStepIndicator", 3)

                            <h2>Website Configuration</h2>
                            <p class="text-muted">Configure your website's public-facing settings</p>

                            @if (!string.IsNullOrEmpty(Model.ErrorMessage))
                            {
                            <div class="alert alert-danger">
                                <strong>Error:</strong> @Model.ErrorMessage
                            </div>
                            }

                            <form method="post" id="publisherForm">
                                <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

                                @Html.AntiForgeryToken()
                                @Html.HiddenFor(m => m.SetupId)

                                <div class="card mb-4 bg-secondary text-light">
                                    <div class="card-header">
                                        <h5>Website Settings</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-group mb-3">
                                            <div id="publisherUrlAlert" class="alert alert-primary" role="alert"
                                                style="display:none;">
                                                Publisher URL is already set and cannot be changed.
                                            </div>
                                            <label asp-for="PublisherUrl" class="form-label">Website URL <span
                                                    class="text-danger">*</span></label>
                                            <input asp-for="PublisherUrl" type="url" class="form-control"
                                                placeholder="https://www.example.com" required />
                                            <span asp-validation-for="PublisherUrl" class="text-danger"></span>
                                            <small class="form-text text-muted text-light">
                                                The public URL where your website will be accessible (without trailing
                                                slash)
                                            </small>
                                        </div>
                                        <div class="form-group mb-3">
                                            <label asp-for="SiteDesignId" class="form-label">Choose a site
                                                design</label>
                                            <select asp-for="SiteDesignId" class="form-select" required="true">
                                                <option value="">Select a design</option>
                                                @foreach (var layout in layouts)
                                                {
                                                <option value="@layout.Id">@layout.Title</option>
                                                }
                                            </select>
                                            <span asp-validation-for="SiteDesignId" class="text-danger"></span>
                                            <small class="form-text text-light">
                                                Please choose a design now, you can change or edit it later. The current
                                                list of
                                                starter designs can be found <a target="_blank"
                                                    href="https://cwalabs.github.io/Cosmos.Starter.Designs/">here</a>.
                                            </small>
                                        </div>

                                        <div class="form-group mb-3">
                                            <label asp-for="WebsiteTitle" class="form-label">Website Title <span
                                                    class="text-danger">*</span></label>
                                            <input asp-for="WebsiteTitle" type="text" class="form-control"
                                                placeholder="My Awesome Website" required />
                                            <span asp-validation-for="WebsiteTitle" class="text-danger"></span>
                                        </div>

                                        <h5 class="text-light">Website name examples:</h5>
                                        <div class="card-group">
                                            <div class="card text-bg-secondary">
                                                <div class="card-header">
                                                    <p class="card-title">Company website names:</p>
                                                </div>
                                                <div class="card-body">
                                                    <ul>
                                                        <li>ACME, Corp.</li>
                                                        <li>Central Perk Coffee</li>
                                                        <li>Gotham Press</li>
                                                        <li>Dunder Mifflin Paper Company</li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <div class="card text-bg-secondary">
                                                <div class="card-header">
                                                    <p class="card-title">Personal website names:</p>
                                                </div>
                                                <div class="card-body">
                                                    <ul>
                                                        <li>Biography of James Bond</li>
                                                        <li>Peter Parker's Blog</li>
                                                        <li>Incantations by Harry Potter</li>
                                                        <li>The Matrix Explained by Neo</li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <div class="card text-bg-secondary">
                                                <div class="card-header">
                                                    <p class="card-title">Topical website names:</p>
                                                </div>
                                                <div class="card-body">
                                                    <ul>
                                                        <li>Baking for Everyone</li>
                                                        <li>Bike Repair 101</li>
                                                        <li>Travel on a Budget</li>
                                                        <li>Zoos and Wildlife Parks</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-check mb-3">
                                            <input asp-for="StaticWebPages" type="checkbox" class="form-check-input"
                                                id="staticWebPages" checked disabled />
                                            <label class="form-check-label" for="staticWebPages">
                                                <strong>Static Website Mode</strong>
                                            </label>
                                            <small class="form-text d-block text-light">
                                                Generate static HTML files for maximum performance and scalability.
                                                Recommended for most websites.
                                            </small>
                                        </div>

                                        <div class="form-check mb-3" style="display:none;">
                                            <div id="cosmosRequiresAuthenticationAlert" class="alert alert-primary"
                                                role="alert" style="display:none;">
                                                Authentication requirement is already set and cannot be changed.
                                            </div>
                                            <input asp-for="CosmosRequiresAuthentication" type="checkbox"
                                                class="form-check-input" id="requiresAuth" />
                                            <label class="form-check-label" for="requiresAuth">
                                                <strong>Require Authentication</strong>
                                            </label>
                                            <small class="form-text d-block text-light">
                                                Require users to log in to access the website (useful for intranets or
                                                private sites)
                                            </small>
                                        </div>

                                        <div class="form-group mb-3">
                                            <div id="allowedFileTypesAlert" class="alert alert-primary" role="alert"
                                                style="display:none;">
                                                Allowed file types are already set and cannot be changed.
                                            </div>
                                            <label asp-for="AllowedFileTypes" class="form-label">Allowed File Types
                                                <span class="text-danger">*</span></label>
                                            <input asp-for="AllowedFileTypes" type="text"
                                                class="form-control font-monospace" value="@Model.AllowedFileTypes"
                                                required />
                                            <span asp-validation-for="AllowedFileTypes" class="text-danger"></span>
                                            <small class="form-text text-light">
                                                Comma-separated list of file extensions allowed for upload (e.g., .jpg,
                                                .png, .pdf)
                                            </small>
                                        </div>
                                    </div>
                                </div>

                                <div class="card mb-4 bg-secondary text-light" style="display:none;">
                                    <div class="card-header">
                                        <h5>Microsoft OAuth (Optional)</h5>
                                    </div>
                                    <div class="card-body">
                                        <p class="text-light">
                                            If you want to allow users to sign in with Microsoft accounts, enter your
                                            Azure AD app credentials.
                                            <a class=" text-light"
                                                href="https://docs.microsoft.com/azure/active-directory/develop/quickstart-register-app"
                                                target="_blank">
                                                Learn how to register an app <i class="fas fa-external-link-alt"></i>
                                            </a>
                                        </p>

                                        <div class="form-group mb-3">
                                            <div id="microsoftAppIdAlert" class="alert alert-primary" role="alert"
                                                style="display:none;">
                                                Microsoft App ID is already set and cannot be changed.
                                            </div>
                                            <label asp-for="MicrosoftAppId" class="form-label">Microsoft Application
                                                (Client) ID</label>
                                            <input asp-for="MicrosoftAppId" type="text"
                                                class="form-control font-monospace"
                                                placeholder="00000000-0000-0000-0000-000000000000" />
                                            <span asp-validation-for="MicrosoftAppId" class="text-danger"></span>
                                            <small class="form-text text-light">
                                                Leave blank to disable Microsoft authentication
                                            </small>
                                        </div>

                                        <div class="alert alert-warning">
                                            <strong><i class="fas fa-exclamation-triangle"></i> Note:</strong>
                                            The Microsoft Client Secret must be configured separately in your
                                            appsettings.json or user secrets:
                                            <code>"MicrosoftOAuth:ClientSecret": "your-secret"</code>
                                        </div>
                                    </div>
                                </div>

                                <div class="d-flex justify-content-between mt-4">
                                    <a href="@Url.Page(" ./Step2_AdminAccount")" class="btn btn-secondary">
                                        <i class="fas fa-arrow-left"></i> Back
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                        Next <i class="fas fa-arrow-right"></i>
                                    </button>
                                </div>

                            </form>
                        </div>
                    </div>
                    @section Scripts {
                    <script>

                        var isPreConfigured = @Model.IsPreConfigured.ToString().ToLower();
                        var cosmosRequiresAuthenticationPreConfigured = @Model.CosmosRequiresAuthenticationPreConfigured.ToString().ToLower();
                        var microsoftAppIdPreConfigured = @Model.MicrosoftAppIdPreConfigured.ToString().ToLower();
                        var staticWebPagesPreConfigured = @Model.StaticWebPagesPreConfigured.ToString().ToLower();
                        var allowedFileTypesPreConfigured = @Model.AllowedFileTypesPreConfigured.ToString().ToLower();

                        $(document).ready(function () {
                            var form = $('#publisherForm');

                            if (isPreConfigured) {
                                $('#PublisherUrl').prop('readonly', true).addClass('bg-secondary');
                                $('#publisherUrlAlert').show();
                            }

                            if (cosmosRequiresAuthenticationPreConfigured) {
                                $('#requiresAuth').prop('disabled', true);
                                $('#cosmosRequiresAuthenticationAlert').show();
                            }

                            if (microsoftAppIdPreConfigured) {
                                $('#MicrosoftAppId').prop('disabled', true);
                                $('#microsoftAppIdAlert').show();
                            }

                            if (staticWebPagesPreConfigured) {
                                $('#staticWebPages').prop('disabled', true);
                            }

                            if (allowedFileTypesPreConfigured) {
                                $('#AllowedFileTypes').prop('disabled', true);
                                $('#allowedFileTypesAlert').show();
                            }

                            // Configure validation
                            $.validator.setDefaults({
                                highlight: function (element) {
                                    $(element).addClass('is-invalid').removeClass('is-valid');
                                },
                                unhighlight: function (element) {
                                    $(element).removeClass('is-invalid').addClass('is-valid');
                                },
                                errorElement: 'span',
                                errorClass: 'text-danger',
                                errorPlacement: function (error, element) {
                                    error.insertAfter(element);
                                }
                            });

                            // Validate URL format
                            $('input[name="PublisherUrl"]').rules('add', {
                                required: true,
                                url: true,
                                messages: {
                                    required: "Website URL is required",
                                    url: "Please enter a valid URL (e.g., https://www.example.com)"
                                }
                            });

                            // Validate allowed file types
                            $('input[name="AllowedFileTypes"]').rules('add', {
                                required: true,
                                messages: {
                                    required: "Allowed file types are required"
                                }
                            });
                        });
                    </script>
                    }

            </main>
        </div>
    </div>
    <footer id="footer" class="footer">
        <div class="container">
            <div class="row">
                <div class="three-quarters">
                </div>
                <div class="quarter text-right">
                    <ul class="socialsharer-container">
                    </ul>
                </div>
            </div>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
        crossorigin="anonymous"></script>
    <script src="~/lib/jquery-validate/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
</body>

</html>